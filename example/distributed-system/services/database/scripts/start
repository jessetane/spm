#
# start
#

# get script dir
DIR="$( cd "$( dirname "$0" )" && pwd )"
DIR="$DIR"/..
cd "$DIR"

[ -e pid ] && echo "Already running!" >&2 && exit 1

# install deps
npm install

# run the app as a bg process and redirect i/o to a log
node database.js >> log 2>&1 &

# record the pid so we can monitor it later
PID=$!
ps -p $PID > /dev/null
STATUS=$?
if [ $STATUS == 0 ]; then
  echo $PID > pid
else
  tail -n 1 log >&2
  exit 1
fi
